# Описание веб-приложения "Multiprovider Chat"

---

## 1. Обзор

Приложение представляет собой веб-чат для взаимодействия с различными языковыми моделями (Yandex GPT и GigaChat).  
Основные характеристики:

- **Целевая аудитория**: пользователи, желающие общаться с различными языковыми моделями для генерации текстов, получения ответов или ведения бесед.
- **MVP-функционал**:
  - Поддержка нескольких провайдеров языковых моделей (Yandex GPT, GigaChat)
  - Выбор провайдера и конкретной модели
  - Поддержка контекста беседы в рамках одной сессии
  - Интуитивный интерфейс с лентой сообщений
  - Настройка параметров генерации текста
- **Будущие релизы**:
  - Сохранение чатов
  - Авторизация и управление пользователями
  - Добавление новых провайдеров
  - Расширение функционала (например, интеграция с внешними сервисами)

---

## 2. Технологический стек

### **Frontend**:
- **Next.js** — фреймворк для создания веб-приложений на основе React
- **Tailwind CSS** — для стилизации интерфейса

### **Backend**:
- **Node.js** — серверная платформа
- **Prisma ORM** — для работы с базой данных
- **SQLite** — легковесная реляционная база данных
- **API провайдеров**:
  - Yandex GPT API
  - GigaChat API

### **База данных**:
- **SQLite** — хранение данных о чатах, сообщениях и настройках

### **Развёртывание**:
- **Yandex Cloud** / **Sber Cloud** — хостинг бэкенда и доступ к API
- **Vercel** или **Netlify** — хостинг фронтенда

---

## 3. Структура приложения

### 3.1. Главная страница
**Цель**: Предоставить интерфейс для общения с различными языковыми моделями.  
**Элементы**:
- Выбор провайдера и модели
- Поле ввода текста с кнопкой отправки
- Лента сообщений (вопросы пользователя и ответы модели)
- Настройки генерации текста:
  - Температура генерации
  - Максимальное количество токенов
- Кнопка "Очистить чат" для сброса контекста

---

### 3.2. Компоненты генерации страницы

#### **Header**
- **Состав**:
  - Логотип приложения
  - Выбор провайдера (Yandex GPT / GigaChat)
  - Выбор модели в зависимости от провайдера
  - Переключатель темы (светлая/тёмная)
  
- **Функциональность**:
  - **Логотип**: Отображает логотип в верхней части страницы
  - **Выбор провайдера**: Позволяет пользователю выбрать провайдера языковой модели
  - **Выбор модели**: Динамически обновляется в зависимости от выбранного провайдера:
    - Для YandexGPT:
      - YandexGPT Lite Latest (поколение 3)
      - YandexGPT Lite RC (поколение 4)
      - YandexGPT Pro Latest (поколение 3)
      - YandexGPT Pro RC (поколение 4)
      - YandexGPT Pro 32k RC (поколение 4)
    - Для GigaChat:
      - GigaChat
      - GigaChat-Pro
      - GigaChat-Max
  - **Переключатель темы**: Позволяет пользователю переключать между светлой и тёмной темой

- **Взаимодействие с API**:
  - При смене модели обновляется URI для запросов к YandexGPT API
  - Выбранная модель сохраняется в состоянии приложения
  - Переключение темы работает локально

---

#### **Chat Window**
- **Состав**:
  - История сообщений.
  - Скроллинг до последнего ответа.

- **Функциональность**:
  - **История сообщений**: Отображает список сообщений, включая запросы пользователя и ответы от GPT. Каждое сообщение имеет пометки, кто его отправил (пользователь или система).
  - **Автоскроллинг**: Когда появляется новый ответ, окно автоматически скроллируется до последнего сообщения.

- **Взаимодействие с API**:
  - **GET** запрос на сервер для получения истории сообщений. Метод `getChatHistory`.

---

#### **Footer**
- **Состав**:
  - Поле ввода текста.
  - Кнопка отправки.
  - Настройки генерации текста (например, параметры для GPT, такие как температура, максимальная длина ответа).

- **Функциональность**:
  - **Поле ввода текста**: Пользователь вводит текст запроса.
  - **Кнопка отправки**: Отправляет текст с запроса на сервер.
  - **Настройки генерации текста**: Пользователь может настраивать параметры генерации текста, такие как температура, длина ответа и другие.

- **Взаимодействие с API**:
  - **POST** запрос для отправки текста от пользователя. Сервер взаимодействует с **Yandex GPT API** для получения ответа, который отображается в **Chat Window**. Метод `sendMessage`.
  - Ответ от GPT отображается в **Chat Window**, поле ввода очищается.

---

#### Программная логика взаимодействия с API

1. Пользователь вводит текст в поле **Footer**.
2. Нажимает кнопку отправки, и приложение отправляет **POST** `sendMessage` запрос на сервер с текстом, параметрами генерации.
3. Сервер передает запрос на **Yandex GPT API**, получает ответ и возвращает его в приложение.
4. Ответ отображается в **Chat Window**. История сообщений и параметры генерации сохраняются в состоянии приложения или базе данных.

---

### 3.3. API сервера

#### **Эндпоинты**
1. `POST /api/chat`  
   Обрабатывает сообщение пользователя, отправляет запрос к Yandex GPT API и возвращает ответ.

   **Пример запроса:**
   ```json
   {
     "input": "Привет! Как ты работаешь?",
     "parameters": {
       "temperature": 0.7,
       "max_tokens": 150
     },
     "session_id": "abc123"
   }
   ```

---

### 3.4. Дизайн

- **Минималистичный и респонсивный интерфейс**:
  Интерфейс приложения ориентирован на простоту и адаптированность под различные устройства, как мобильные, так и десктопные.

  ```css
  /* Базовая настройка для адаптивного дизайна */
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
    background-color: var(--background-color);
    transition: background-color 0.3s ease-in-out;
  }

  @media (max-width: 768px) {
    body {
      padding: 10px;
    }
  }
  ```
- **Цветовая палитра**:
Приложение поддерживает светлую и тёмную темы, которые легко переключаются через CSS переменные.

```css
/* Цветовая палитра */
:root {
  --light-background: #F5F5F5;
  --dark-background: #181818;
  --button-primary: #1E90FF;
  --button-hover: #4682B4;
}

/* Светлая тема */
.light-theme {
  background-color: var(--light-background);
  color: #000;
}

/* Тёмная тема */
.dark-theme {
  background-color: var(--dark-background);
  color: #fff;
}

/* Переключение темы */
.theme-toggle {
  background-color: var(--button-primary);
  color: white;
  border: none;
  border-radius: 30px;
  padding: 10px;
  cursor: pointer;
}

.theme-toggle:hover {
  background-color: var(--button-hover);
}
```

- **Шрифты**:
Используем шрифты Roboto или Open Sans для комфортного чтения текста, с разным весом шрифта для заголовков и основного контента.

```css
/* Шрифт для основного текста */
body {
  font-family: 'Roboto', sans-serif;
  font-weight: 400;
}

/* Шрифт для заголовков */
h1, h2, h3 {
  font-family: 'Open Sans', sans-serif;
  font-weight: 600;
}
```

- **Стиль кнопок**:
Кнопки имеют закругленные углы и плавные анимации для интерактивности.

```css
/* Основная кнопка */
.btn-primary {
  background-color: var(--button-primary);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 30px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease-in-out;
}

.btn-primary:hover {
  background-color: var(--button-hover);
}

/* Кнопка отправки */
.btn-send {
  background-color: #4CAF50;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 50%;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s;
}

.btn-send:hover {
  background-color: #45a049;
  transform: scale(1.1);
}
```

- **Анимации и взаимодействия**:
Кнопки и элементы интерфейса анимируются для улучшения взаимодействия с пользователем.

```css
/* Анимация для кнопок */
.btn-primary {
  transition: transform 0.2s ease-in-out;
}

.btn-primary:hover {
  transform: scale(1.05);
}
```

- **Мобильная адаптивность**:
Интерфейс приложения оптимизирован для мобильных устройств с использованием медиазапросов.

```css
/* Адаптивность для мобильных устройств */
@media (max-width: 768px) {
  .chat-window {
    max-height: 400px;
  }

  .footer {
    padding: 20px 10px;
  }

  .btn-primary {
    font-size: 14px;
    padding: 10px 16px;
  }
}
```

---

### 3.5. Модель генерации текста

Используется Yandex GPT Pro с поддержкой контекста.  
Каждый запрос содержит историю сообщений, передаваемую вместе с текстом пользователя.

---

### 3.6. Сценарий работы приложения

1. Открытие приложения
- При открытии приложения, пользователю отображается главная страница с интерфейсом чата, включая поле ввода для текста и область для истории сообщений. В интерфейсе также отображается кнопка для отпраки сообщения и параметры для настройки генерации текста (например, температура, длина ответа).
2. Ввод запроса пользователем
- Пользователь вводит текст запроса в поле ввода сообщения в Footer (нижняя часть экрана). После ввода текста, он нажимает кнопку отправки, чтобы отправить запрос на сервер.
3. Отправка запроса на сервер
- После нажатия кнопки отправки, приложение отправляет POST запрос на сервер с текстом, введённым пользователем, а также дополнительными параметрами генерации, такими как температура и максимальная длина ответа. Запрос выглядит следующим образом:
4. Обработка запроса на сервере
- Сервер принимает запрос, извлекает из него текст и параметры, и передаёт их в Yandex GPT API для обработки. Приложение может поддерживать сессии, что позволяет сохранять контекст беседы между запросами.
5. Получение ответа от Yandex GPT API
- После того как сервер передает запрос в Yandex GPT API, модель обрабатывает запрос и генерирует текстовый ответ, который отправляется обратно на сервер. Например, ответ от GPT может быть таким:

6. Отображение ответа в ленте чата
- Сервер отправляет полученный ответ обратно в приложение, где он отображается в ленте сообщений. Ответ от модели отображается с меткой “Assistant” или аналогичной, чтобы пользователь мог отличить его от своих сообщений.
7. Сохранение контекста до окончания сессии
- Контекст беседы сохраняется на стороне клиента или сервера, в зависимости от архитектуры приложения. Это позволяет модели учитывать предыдущие сообщения при формировании новых ответов, сохраняя непрерывность беседы.
- Например, если пользователь задает вопрос “Что ты сказал ранее?”, модель будет использовать контекст, чтобы ответить с учётом предыдущих сообщений. Контекст сохраняется до тех пор, пока сессия активна, и может быть очищен вручную пользователем через кнопку “Очистить чат” или автоматически по завершению сессии.
8. Очистка чата
- В любой момент пользователь может нажать на кнопку “Очистить чат”, что удалит всю историю сообщений и сбросит контекст. Это действие может быть полезно для начала нового разговора без учета предыдущих запросов.

---

### 3.7. Структура базы данных

```js
{
  "tables": {
    "chats": {
      "columns": {
        "chat_id": {
          "type": "UUID",
          "primary_key": true,
          "description": "Уникальный идентификатор чата"
        },
        "provider": {
          "type": "VARCHAR(50)",
          "description": "Провайдер языковой модели (yandex/gigachat)"
        },
        "created_at": {
          "type": "TIMESTAMPTZ",
          "default": "CURRENT_TIMESTAMP",
          "description": "Время начала чата"
        }
      }
    },
    "messages": {
      "columns": {
        "id": {
          "type": "SERIAL",
          "primary_key": true,
          "description": "Уникальный идентификатор сообщения"
        },
        "chat_id": {
          "type": "UUID",
          "description": "Уникальный идентификатор чата, связанный с сообщением",
          "foreign_key": {
            "table": "chats",
            "column": "chat_id"
          }
        },
        "message": {
          "type": "TEXT",
          "description": "Текст сообщения пользователя"
        },
        "response": {
          "type": "TEXT",
          "description": "Ответ от языковой модели"
        },
        "model": {
          "type": "VARCHAR(50)",
          "description": "Название модели, использованной для генерации ответа"
        },
        "timestamp": {
          "type": "TIMESTAMPTZ",
          "default": "CURRENT_TIMESTAMP",
          "description": "Время отправки сообщения"
        },
        "temperature": {
          "type": "DECIMAL(3,2)",
          "description": "Параметр температуры для генерации ответа"
        },
        "max_tokens": {
          "type": "INT",
          "description": "Максимальное количество токенов в ответе"
        }
      }
    }
  }
}
```