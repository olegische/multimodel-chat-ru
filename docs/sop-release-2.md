# SOP: Процедура релиза 2.0 (Multi-provider)

## 1. Подготовительный этап

### 1.1. Обновление зависимостей
- [x] Аудит текущих зависимостей
- [x] Обновление пакетов до актуальных версий
  - Добавлены: axios, date-fns, uuid
  - Добавлены dev: @types/uuid
- [x] Проверка совместимости

### 1.2. Подготовка API ключей
- [x] Получение API ключа GigaChat
- [x] Обновление .env файла
- [x] Тестирование доступа к API

## 2. Разработка бэкенда

### 2.1. Провайдеры (providers/)
1. Базовый провайдер
   - [x] Создание base.provider.ts
   - [x] Определение базовых интерфейсов
   - [x] Реализация общих методов

2. Фабрика провайдеров
   - [x] Создание factory.ts
   - [x] Реализация метода создания провайдера
   - [x] Тестирование фабрики

3. YandexGPT Provider
   - [x] Рефакторинг существующего кода в новую структуру
   - [x] Реализация специфичных методов
   - [x] Тестирование провайдера

4. GigaChat Provider
   - [x] Реализация авторизации OAuth
   - [x] Реализация обновления токена
   - [x] Маппинг моделей
   - [x] Тестирование провайдера

### 2.2. Сервисный слой (services/)
1. ChatService
   - [ ] Реализация выбора провайдера
   - [ ] Обработка сообщений
   - [ ] Управление контекстом
   - [ ] Тестирование

2. ModelService
   - [ ] Получение моделей от провайдеров
   - [ ] Кэширование списков моделей
   - [ ] Валидация моделей
   - [ ] Тестирование

3. ProviderService
   - [ ] Управление провайдерами
   - [ ] Мониторинг состояния
   - [ ] Обработка ошибок
   - [ ] Тестирование

### 2.3. База данных
1. Обновление схемы
   - [ ] Добавление таблицы providers
   - [ ] Обновление связей
   - [ ] Создание миграций

2. Обновление репозитория
   - [ ] Обновление методов работы с БД
   - [ ] Тестирование новой схемы

### 2.4. API Routes
1. Обновление существующих endpoints
   - [ ] Рефакторинг /api/chat
   - [ ] Рефакторинг /api/messages
   - [ ] Тестирование

2. Добавление новых endpoints
   - [ ] Создание /api/providers
   - [ ] Обновление /api/models
   - [ ] Тестирование

## 3. Разработка фронтенда

### 3.1. Компоненты
1. ProviderSelector
   - [ ] Создание компонента
   - [ ] Интеграция с Header
   - [ ] Стилизация
   - [ ] Тестирование

2. Обновление ModelSelector
   - [ ] Поддержка разных провайдеров
   - [ ] Динамическая загрузка моделей
   - [ ] Тестирование

3. Обновление ChatWindow
   - [ ] Поддержка провайдеров
   - [ ] Обновление UI
   - [ ] Тестирование

4. Обновление Footer
   - [ ] Интеграция с провайдерами
   - [ ] Обновление настроек
   - [ ] Тестирование

### 3.2. Состояние приложения
1. Обновление page.tsx
   - [ ] Добавление состояния провайдера
   - [ ] Обновление обработчиков
   - [ ] Тестирование

## 4. Тестирование

### 4.1. Модульное тестирование
- [ ] Тестирование провайдеров
- [ ] Тестирование сервисов
- [ ] Тестирование компонентов
- [ ] Тестирование API

### 4.2. Интеграционное тестирование
- [ ] Тестирование взаимодействия провайдеров
- [ ] Тестирование UI с разными провайдерами
- [ ] Тестирование переключения провайдеров
- [ ] Тестирование сохранения контекста

### 4.3. E2E тестирование
- [ ] Сценарии использования разных провайдеров
- [ ] Проверка корректности ответов
- [ ] Проверка обработки ошибок

## 5. Документация

### 5.1. Техническая документация
- [ ] Обновление архитектурной документации
- [ ] Документация провайдеров
- [ ] API документация
- [ ] Схема базы данных

### 5.2. Пользовательская документация
- [ ] Инструкции по использованию провайдеров
- [ ] Описание моделей
- [ ] Обновление FAQ

## 6. Критерии готовности

### 6.1. Функциональные критерии
- [ ] Работает выбор провайдера
- [ ] Корректно работают все провайдеры
- [ ] Сохраняется контекст беседы
- [ ] Работают все настройки генерации
- [ ] Корректно отображаются ошибки

### 6.2. Технические критерии
- [ ] Все тесты проходят успешно
- [ ] Корректно работает авторизация провайдеров
- [ ] База данных работает корректно
- [ ] API endpoints отвечают корректно
- [ ] Приложение работает локально

### 6.3. Документационные критерии
- [ ] Обновлена вся документация
- [ ] README актуален
- [ ] API документация полная
- [ ] Инструкции по установке проверены

## 7. Последовательность релиза

1. Подготовка инфраструктуры
   - [ ] Обновление зависимостей
   - [ ] Настройка окружения

2. Разработка бэкенда
   - [ ] Провайдеры
   - [ ] Сервисы
   - [ ] База данных
   - [ ] API

3. ��азработка фронтенда
   - [ ] Компоненты
   - [ ] Интеграция

4. Тестирование
   - [ ] Модульные тесты
   - [ ] Интеграционные тесты
   - [ ] E2E тесты

5. Документация
   - [ ] Техническая
   - [ ] Пользовательская

6. Релиз
   - [ ] Финальное тестирование
   - [ ] Деплой
   - [ ] Мониторинг

## 8. Мониторинг после релиза

### 8.1. Технический мониторинг
- [ ] Мониторинг ошибок провайдеров
- [ ] Мониторинг производительности
- [ ] Мониторинг использования API

### 8.2. Пользовательский мониторинг
- [ ] Сбор обратной связи
- [ ] Анализ использования провайдеров
- [ ] Анализ проблем пользователей
