# Архитектура Multimodel Chat

## 1. Общий обзор
Multimodel Chat - это веб-приложение для взаимодействия с различными языковыми моделями (LLM), построенное на основе Next.js с использованием серверных компонентов и API-маршрутов.

## 2. Компоненты системы

### 2.1. Frontend
- **Framework**: Next.js 14.x
- **UI компоненты**: React 18.x
- **Стилизация**: Tailwind CSS
- **Темизация**: next-themes для поддержки светлой/тёмной темы

### 2.2. Backend
- **API Routes**: Next.js API маршруты
- **База данных**: SQLite через Prisma ORM
- **Валидация**: Zod для проверки входящих данных
- **LLM интеграция**: Yandex GPT API (с планируемой поддержкой GigaChat)

### 2.3. Хранение данных
- **ORM**: Prisma
- **База данных**: SQLite
- **Схема данных**:
  ```
  Chat (1) --- (n) Message
  ```

## 3. Основные модули

### 3.1. Модуль чата
- `src/app/api/chat/route.ts` - обработка сообщений чата
- `src/app/api/messages/route.ts` - получение истории сообщений
- `src/lib/yandexGpt.ts` - интеграция с Yandex GPT

### 3.2. Модуль базы данных
- `src/lib/db.ts` - инициализация Prisma Client
- `prisma/schema.prisma` - схема базы данных
- Миграции Prisma для управления структурой БД

### 3.3. Модуль тестирования
- Jest для модульных тестов
- Тестирование API endpoints
- Тестирование интеграции с базой данных

## 4. Развертывание

### 4.1. Контейнеризация
- Dockerfile для сборки образа
- Multi-stage builds для оптимизации
- Поддержка различных архитектур (AMD64/ARM64)

### 4.2. Инфраструктура
- Docker для контейнеризации
- Nginx как reverse proxy
- Container Registry (Yandex Cloud) для хранения образов

## 5. Безопасность

### 5.1. Защита API
- Валидация входящих данных через Zod
- Защита от инъекций через Prisma
- Rate limiting (планируется)

### 5.2. Инфраструктурная безопасность
- fail2ban для защиты от сканирования
- HTTPS через Nginx
- Безопасное хранение переменных окружения

## 6. Масштабирование

### 6.1. Текущие возможности
- Горизонтальное масштабирование через Docker
- Кэширование ответов API
- Оптимизация запросов к базе данных

### 6.2. Планируемые улучшения
- Интеграция с GigaChat
- Поддержка множества LLM провайдеров
- Система пользователей и авторизации

## 7. Мониторинг и логирование
- Логирование через Docker
- Мониторинг состояния контейнеров
- Отслеживание ошибок API

## 8. Процесс разработки
- Git для версионирования
- Conventional Commits
- Документация в формате Markdown
- SOP для релизов и развертывания

## 9. Зависимости
```json
{
  "core": {
    "next": "14.x",
    "react": "18.x",
    "prisma": "5.22.0"
  },
  "api": {
    "zod": "3.x"
  },
  "dev": {
    "typescript": "5.x",
    "jest": "29.x"
  }
}
```

## 10. Требования к окружению
- Node.js 20.x
- Docker
- Git
- SQLite
- Nginx